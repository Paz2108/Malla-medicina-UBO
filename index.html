<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Malla Interactiva Medicina</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: sans-serif;
      background-color: #f8f9fa;
      margin: 0;
      padding: 20px;
    }
    h1 {
      text-align: center;
      margin-bottom: 20px;
    }
    .semestres {
      display: flex;
      flex-wrap: nowrap;
      overflow-x: auto;
      gap: 20px;
      padding-bottom: 20px;
    }
    .semestre {
      flex: 0 0 auto;
      min-width: 250px;
      background-color: #fff;
      border: 1px solid #ccc;
      border-radius: 10px;
      padding: 10px;
    }
    .semestre h2 {
      text-align: center;
      font-size: 16px;
      margin: 10px 0;
    }
    .ramo {
      background-color: #e0f7fa;
      margin: 10px 0;
      padding: 10px;
      border-radius: 6px;
      text-align: center;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    .ramo:hover {
      background-color: #b2ebf2;
    }
    .aprobado {
      text-decoration: line-through;
      background-color: #dcedc8 !important;
    }
    .habilitado {
      background-color: #fff9c4 !important;
    }
    @media (max-width: 768px) {
      .semestres {
        flex-wrap: wrap;
        justify-content: center;
      }
      .semestre {
        width: 90%;
        max-width: 350px;
      }
    }
  </style>
</head>
<body>
  <h1>Malla Curricular Interactiva - Medicina UBO</h1>
  <div class="semestres" id="contenedorMalla"></div>

  <script>
    const malla = {
      "1": [
        { id: "bases_quim", nombre: "Bases Químicas de la Medicina", abre: ["bio_cel"] },
        { id: "fis_med", nombre: "Física Médica", abre: ["morfo1"] },
        { id: "biomatematicas", nombre: "Biomatemáticas", abre: ["salud_pub"] },
        { id: "intro_med", nombre: "Introducción a la medicina e intervención básica en emergencias", abre: ["elem_clin"] },
        { id: "ingles1", nombre: "Inglés I", abre: ["ingles2"] },
        { id: "hab1", nombre: "Habilidades Académicas I", abre: ["hab2"] }
      ],
      "2": [
        { id: "bio_cel", nombre: "Biología Celular y Molecular Médica", abre: ["bioq"] },
        { id: "morfo1", nombre: "Morfología Integrada I", abre: ["morfo2"] },
        { id: "salud_pub", nombre: "Salud Pública y Estadística aplicada a la Medicina", abre: ["metodo"] },
        { id: "elem_clin", nombre: "Elementos Clínicos Básicos" },
        { id: "ingles2", nombre: "Inglés II", abre: ["ingles3"] },
        { id: "hab2", nombre: "Habilidades Académicas II" }
      ],
      "3": [
        { id: "bioq", nombre: "Bioquímica Médica y Genética Clínica", abre: ["farm_gen", "bases1"] },
        { id: "morfo2", nombre: "Morfología Integrada II", abre: ["morfo3", "bases1"] },
        { id: "elect1", nombre: "Electivo I" },
        { id: "sns1", nombre: "Sistema Nacional de Salud I", abre: ["sns2"] },
        { id: "integ1", nombre: "Integración Clínica I", abre: ["integ2"] },
        { id: "ingles3", nombre: "Inglés III", abre: ["ingles4"] }
      ],
      "4": [
        { id: "morfo3", nombre: "Morfología Integrada III", abre: ["farm_gen"] },
        { id: "sns2", nombre: "Sistema Nacional de Salud II", abre: ["sns3"] },
        { id: "metodo", nombre: "Metodología de la Investigación y Medicina Basada en la Evidencia", abre: ["sns3"] },
        { id: "bases1", nombre: "Bases y Mecanismos de la Salud y Enfermedad I", abre: ["diag1", "bases2"] },
        { id: "integ2", nombre: "Integración Clínica II", abre: ["pract1"] },
        { id: "ingles4", nombre: "Inglés IV" }
      ]
    };

    const relacionesExtra = {
      "farm_gen": ["farm_clin"],
      "diag1": ["diag2", "med_int1"],
      "bases2": ["bases3", "med_int1"],
      "med_int1": ["med_int2"],
      "diag2": ["metodos"],
      "bases3": ["med_int2"],
      "metodos": ["neuro", "onco", "nutri", "gine", "orto", "fisio", "ciru", "pedi", "oft_derm", "urg", "psiq"],
      "med_int2": ["neuro", "onco", "nutri", "gine", "orto", "fisio", "ciru", "pedi", "oft_derm", "urg", "psiq"],
      "pract1": ["pract2"],
      "pract2": ["pract3"],
      "pract3": ["pract4"],
      "pract4": ["pract5"],
      "pract5": ["pract6"],
      "sns3": ["sns4"],
      "sns4": ["sns5"],
      "sns5": ["gest"],
      "etica": ["resp_soc"],
      "psico": ["fisio"],
      "internado1": ["internado2"],
      "internado2": ["internado3"],
      "internado3": ["internado4"]
    };

    const contenedor = document.getElementById("contenedorMalla");
    const aprobados = new Set();

    Object.entries(malla).forEach(([semestre, ramos]) => {
      const col = document.createElement("div");
      col.className = "semestre";
      col.innerHTML = `<h2>${semestre}º semestre</h2>`;

      ramos.forEach(ramo => {
        const div = document.createElement("div");
        div.className = "ramo";
        div.id = ramo.id;
        div.textContent = ramo.nombre;

        div.addEventListener("click", () => {
          div.classList.toggle("aprobado");
          const estaAprobado = div.classList.contains("aprobado");
          if (estaAprobado) {
            aprobados.add(ramo.id);
          } else {
            aprobados.delete(ramo.id);
          }

          document.querySelectorAll('.ramo').forEach(r => r.classList.remove("habilitado"));

          Object.values(malla).flat().forEach(r => {
            if (r.abre) {
              r.abre.forEach(id => {
                const habilitado = document.getElementById(id);
                if (habilitado && !habilitado.classList.contains("aprobado")) {
                  const requisitos = Object.values(malla).flat().filter(x => x.abre?.includes(id));
                  const cumplidos = requisitos.every(x => aprobados.has(x.id));
                  if (cumplidos) habilitado.classList.add("habilitado");
                }
              });
            }
          });

          Object.entries(relacionesExtra).forEach(([id, abreList]) => {
            if (aprobados.has(id)) {
              abreList.forEach(a => {
                const sig = document.getElementById(a);
                if (sig && !sig.classList.contains("aprobado")) {
                  sig.classList.add("habilitado");
                }
              });
            }
          });
        });

        col.appendChild(div);
      });

      contenedor.appendChild(col);
    });
  </script>
</body>
</html>
